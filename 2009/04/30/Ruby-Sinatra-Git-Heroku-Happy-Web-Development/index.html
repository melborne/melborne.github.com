
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    
      <title>Ruby.Sinatra.Git.Heroku #=> "Happy Web Development!"</title>
    
    
    <meta name="author" content="kyoendo" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter-ext/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/themes/twitter-ext/css/style.css?body=1" rel="stylesheet" type="text/css" media="all" />
    <link href="/assets/themes/twitter-ext/css/syntax.css" rel="stylesheet" type="text/css" />
    <link href="/assets/themes/twitter-ext/css/lightbox.css" rel="stylesheet" />
    <link media="only screen and (max-device-width: 480px)" href="/assets/themes/twitter-ext/css/iphone.css" type="text/css" rel="stylesheet" />
    <!--<link media="only screen and (device-width: 768px)" href="/assets/themes/twitter-ext/css/ipad.css" type="text/css" rel="stylesheet" />-->
    <!--<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />-->
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />-->
<!--<script type="text/x-mathjax-config">-->
  <!--MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });-->
<!--</script>-->
<!--<script type="text/javascript"-->
  <!--src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">-->
<!--</script>-->
  </head>
  <body>
    <div id="fb-root"></div>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="avatar" href="/">
            <img src="http://gravatar.com/avatar/97aa01a6f87da85251be77792dec1d9c?s=80" height="75" width="75" class="avatar" />
          </a>
          <a class="brand" href="/">hp12c</a>
          <div id='rss'>
            <a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon32x32.png" alt="" style="border:0"/></a><a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"></a>
            <!--<a href="/atom.xml" id="rss">-->
              <!--<img src="/assets/images/site/rss.png" alt="rss" title="RSS" height="22" width="22" />-->
            <!--</a>-->
          </div>
          <ul class="nav">
            <li>
              <a class="books" href="/books/">Books</a>
            </li>
            <li>
              <a class="mygems" href="https://rubygems.org/profiles/melborne/">Gems</a>
            </li>
            <li>
              <a class="myproducts" href="http://welove.herokuapp.com/users/54">Products</a>
            </li>
            
            
            


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
    	
      <li><a href="/tags.html">Tags</a></li>
    	
    
  








            <li class='site'>
              <a href="https://twitter.com/merborne" id="twitter">
                <img src="/assets/images/site/twitter.png" alt="twitter" title="@merborne on Twitter" height="32" width="32" />
              </a>
            </li>
            <li class='site'>
              <a href="https://github.com/melborne" id="github">
                <img src="/assets/images/site/github.png" alt="github" title="@melborne on GitHub" height="24" width="24" />
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header span8">
  <div class="date"><span>30 April 2009</span></div>
  <h1 class='page-title'><a href="/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development">Ruby.Sinatra.Git.Heroku #=> "Happy Web Development!"</a> <small>  </small></h1>
</div>

<div class="row">
  <div class="span9">
    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* hp12c */
      google_ad_slot = "7055414638";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <h2>Ruby</h2>

<p>10年前にRubyといえば7月の誕生石のことか、5.5ポイント活字のことでした。でも今はGoogleを30頁めくっても、妻に誕生石をプレゼントすることはできません。宝石店のSEO対策は日本人の作った言語セットの前では無力なのです。</p>

<p>この点PerlのLarryさんは巧妙にやりました。Pearlは今も6月の誕生石の地位を守っています。ここにLarryの奥さんは6月生まれであり、Matzの奥さんは7月生まれでないとの仮説が成り立ちます。</p>

<h2>Sinatra</h2>

<p>なぜWebフレームワークの名前を<a href="http://www.sinatrarb.com/">Sinatra</a>としたのか皆目検討も付きません。シナトラハットがトレードマークですから、そうなんでしょうがそれにしても...Railsとは違うMyWayを行くという意味でしょうか。それとも裏社会との繋がりを暗示しているのでしょうか。まさか「<a href="http://www.google.co.jp/search?client=safari&amp;rls=ja-jp&amp;q=%E6%94%AF%E9%82%A3%E8%99%8E&amp;esrch=BetaShortcuts&amp;ie=UTF-8&amp;oe=UTF-8">支那虎</a>」ですか？</p>

<p>ー名は体を表すー といいますが、これほどに体をイメージし辛い名も滅多にありません。改名を強く望みます。Googleで「<a href="http://www.google.co.jp/search?client=safari&amp;rls=ja-jp&amp;q=sinatra&amp;esrch=BetaShortcuts&amp;ie=UTF-8&amp;oe=UTF-8">Sinatra</a>」と打って、このWebフレームワークがトップに来た日がその命日にならないことを祈りつつ。</p>

<h2>Git</h2>

<p><a href="http://git-scm.com/">Git</a>は「ぎっと」と発音します。意味はこうです。</p>

<div class="highlight"><pre><code class="bash"> git  <span class="o">{</span>名<span class="o">}</span> : まぬけ、ばか、あほ、役立たず、無能な人
</code></pre></div>


<p>Linusさんにそう言われれば返す言葉は何もありません。でも消沈する必要はありません。「git」とググられて、わたしやあなたの名前はもう出てこないのですから。これは<a href="http://en.wikipedia.org/wiki/Google_bomb">GoogleBomb</a>ではなくGooglePieceなのです。ですから誰か早く、ヴァージョン管理システム「<a href="http://www.google.co.jp/search?client=safari&amp;rls=ja-jp&amp;q=ass%20hole&amp;esrch=BetaShortcuts&amp;ie=UTF-8&amp;oe=UTF-8">ass hole</a>」を作って我が国の首相を救ってください！</p>

<h2>Heroku</h2>

<p><a href="http://heroku.com/">Heroku</a>は「Her-OH-koo」と発音します。Google App Engineほどつまらない名前はないですが、その意味に辿り着けないというのもまたつまらないものです。でも、わたしはその答えにおそらく辿り着けました。ヒントはプライスリストです。</p>

<p><a href="http://heroku.com/pricing#blossom-2">Heroku | Pricing</a></p>

<p>彼らもまた東洋の神秘に見せられていたのです！でも答えは「奥歯」じゃありません。韓流にハマっている妻に付き合っていた意味が、今顕在化したのです...</p>

<p>Herokuはハングルで「&#54616;&#50725;」と書きます。意味は「下獄」つまり、「罪人を牢屋に入れること」です。つまりHerokuユーザは、知らずのうちに罪人とされていたのです！わたしも気が付くのが遅すぎました。暫く刑に服そうと思います。「<a href="http://www3.nhk.or.jp/kaigai/tamo/">チェオクの剣</a>」でも見ながら...</p>

<p>Sinatraを使って無機能Webカレンダーを作ります。それをGitでHerokuにデプロイします。OSX+Terminal+TextMateを前提に書きます。</p>

<p>あなたも罪人になってみませんか？</p>

<h2>Ruby+Sinatra</h2>

<p>Sinatraをインストールします。現時点でRuby1.9には完全には対応していません。</p>

<div class="highlight"><pre><code class="ruby"> <span class="sx">% sudo </span><span class="n">gem</span> <span class="n">install</span> <span class="n">sinatra</span>
</code></pre></div>


<p>mycalフォルダにmycal.rbファイルを作ります。</p>

<div class="highlight"><pre><code class="ruby"> <span class="sx">% mkdir </span><span class="n">mycal</span>
 <span class="o">%</span> <span class="n">cd</span> <span class="n">mycal</span><span class="o">/</span>
 <span class="n">mycal</span><span class="o">%</span> <span class="n">mate</span> <span class="n">mycal</span><span class="o">.</span><span class="n">rb</span>
</code></pre></div>


<p>mycal.rbを編集します。</p>

<div class="highlight"><pre><code class="ruby"> <span class="nb">require</span> <span class="s2">&quot;rubygems&quot;</span>
 <span class="nb">require</span> <span class="s2">&quot;sinatra&quot;</span>
 
 <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
   <span class="vi">@year</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">year</span>
   <span class="vi">@ycal</span> <span class="o">=</span> <span class="sb">`cal </span><span class="si">#{</span><span class="vi">@year</span><span class="si">}</span><span class="sb">`</span>
   <span class="n">erb</span> <span class="ss">:index</span>
 <span class="k">end</span>
 
 <span class="cp">__END__</span>
<span class="cp"> @@index</span>
<span class="cp"> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="cp">   &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="cp"> &lt;html&gt;</span>
<span class="cp">   &lt;head&gt;</span>
<span class="cp">     &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span>
<span class="cp">     &lt;title&gt;mycal&lt;/title&gt;</span>
<span class="cp">   &lt;/head&gt;</span>
<span class="cp">   &lt;body id=&quot;mycal&quot;&gt;</span>
<span class="cp">     &lt;pre&gt;&lt;%= @ycal %&gt;&lt;/pre&gt;</span>
<span class="cp">   &lt;/body&gt;</span>
<span class="cp"> &lt;/html&gt;</span>
</code></pre></div>


<p>`(バッククオート)でシェルコマンドcalを呼んでいます。__END__以降にerbテンプレートを書きます。@@indexがラベルです。</p>

<p>calが使えない環境の場合、ふなばただよしさんのcal.rbが使えます。</p>

<p><a href="http://www.funaba.org/ruby.html#cal">cal.rb</a></p>

<p>その場合cal.rbをrequireして@ycal = `cal...を以下に変えます。</p>

<div class="highlight"><pre><code class="ruby"> <span class="nb">require</span> <span class="s1">&#39;cal&#39;</span>
 <span class="n">cal</span> <span class="o">=</span> <span class="no">Cal</span><span class="o">.</span><span class="n">new</span>
 <span class="n">cal</span><span class="o">.</span><span class="n">opt_y</span><span class="p">(</span><span class="n">mon</span> <span class="p">?</span> <span class="kp">false</span> <span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
 <span class="vi">@ycal</span> <span class="o">=</span> <span class="n">cal</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">)</span>
</code></pre></div>


<p>mycal.rbを実行します。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">ruby</span> <span class="n">mycal</span><span class="o">.</span><span class="n">rb</span>
</code></pre></div>


<p>Webサーバが起動するので、ブラウザでhttp://localhost:4567/にアクセスします。カレンダーが表示されます。</p>

<p>サーバを起動したまま、mycal.rbに以下を追加します。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">get</span> <span class="s1">&#39;/:year&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">year</span><span class="o">|</span>
   <span class="vi">@year</span> <span class="o">=</span> <span class="n">year</span><span class="o">.</span><span class="n">to_i</span>
   <span class="vi">@ycal</span> <span class="o">=</span> <span class="sb">`cal </span><span class="si">#{</span><span class="vi">@year</span><span class="si">}</span><span class="sb">`</span>
   <span class="n">erb</span> <span class="ss">:year</span>
 <span class="k">end</span>
</code></pre></div>


<p>__END__以下を次のように変えます。</p>

<div class="highlight"><pre><code class="ruby"> <span class="cp">__END__</span>
<span class="cp"> @@layout</span>
<span class="cp"> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="cp">   &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="cp"> &lt;html&gt;</span>
<span class="cp">   &lt;head&gt;</span>
<span class="cp">     &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span>
<span class="cp">     &lt;title&gt;mycal&lt;/title&gt;</span>
<span class="cp">   &lt;/head&gt;</span>
<span class="cp">   &lt;body id=&quot;mycal&quot;&gt;</span>
<span class="cp">     &lt;pre&gt;&lt;%= yield %&gt;&lt;/pre&gt;    </span>
<span class="cp">   &lt;/body&gt;</span>
<span class="cp"> &lt;/html&gt;</span>
<span class="cp"> </span>
<span class="cp"> @@index</span>
<span class="cp"> &lt;%= @ycal %&gt;</span>
<span class="cp"> </span>
<span class="cp"> @@year</span>
<span class="cp"> &lt;%= @ycal %&gt;</span>
</code></pre></div>


<p>つまり \&lt;pre>\&lt;/pre> 内にyieldを置いてlayoutと実体を分けます。</p>

<p>ブラウザでhttp://localhost:4567/1999にアクセスします。1999年のカレンダーが表示されます。</p>

<p>mycal.rbに以下を追加します。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">get</span> <span class="s1">&#39;/:year/:mon&#39;</span> <span class="k">do</span> <span class="o">|*</span><span class="n">ym</span><span class="o">|</span>
   <span class="vi">@year</span><span class="p">,</span> <span class="vi">@mon</span> <span class="o">=</span> <span class="n">ym</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">.</span><span class="n">to_i</span>  <span class="p">}</span>
   <span class="vi">@mcal</span> <span class="o">=</span> <span class="sb">`cal </span><span class="si">#{</span><span class="vi">@mon</span><span class="si">}</span><span class="sb"> </span><span class="si">#{</span><span class="vi">@year</span><span class="si">}</span><span class="sb">`</span>
   <span class="n">erb</span> <span class="ss">:mon</span>
 <span class="k">end</span>
 
 <span class="cp">__END__</span>
<span class="cp"> </span>
<span class="cp"> @@mon</span>
<span class="cp"> &lt;%= @mcal %&gt;</span>
</code></pre></div>


<p>ブラウザでhttp://localhost:4567/1999/12にアクセスします。1999年12月のカレンダーが表示されます。</p>

<p>helpersを使って`cal...を一ヶ所にまとめます。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
   <span class="vi">@year</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">year</span>
   <span class="vi">@ycal</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="vi">@year</span><span class="p">)</span>
   <span class="n">erb</span> <span class="ss">:index</span>
 <span class="k">end</span>
 
 <span class="n">get</span> <span class="s1">&#39;/:year&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">year</span><span class="o">|</span>
   <span class="vi">@year</span> <span class="o">=</span> <span class="n">year</span><span class="o">.</span><span class="n">to_i</span>
   <span class="vi">@ycal</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="vi">@year</span><span class="p">)</span>
   <span class="n">erb</span> <span class="ss">:year</span>
 <span class="k">end</span>
 
 <span class="n">get</span> <span class="s1">&#39;/:year/:mon&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">ym</span><span class="o">|</span>
   <span class="vi">@year</span><span class="p">,</span> <span class="vi">@mon</span> <span class="o">=</span> <span class="n">ym</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">.</span><span class="n">to_i</span>  <span class="p">}</span>
   <span class="vi">@mcal</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="vi">@year</span><span class="p">,</span> <span class="vi">@mon</span><span class="p">)</span>
   <span class="n">erb</span> <span class="ss">:mon</span>
 <span class="k">end</span>
 
 <span class="n">helpers</span> <span class="k">do</span>
   <span class="k">def</span> <span class="nf">cal</span><span class="p">(</span><span class="o">*</span><span class="n">date</span><span class="p">)</span>
     <span class="n">year</span><span class="p">,</span> <span class="n">mon</span> <span class="o">=</span> <span class="n">date</span>
     <span class="sb">`cal </span><span class="si">#{</span><span class="n">mon</span><span class="si">}</span><span class="sb"> </span><span class="si">#{</span><span class="n">year</span><span class="si">}</span><span class="sb">`</span>
   <span class="k">end</span>
 <span class="k">end</span>
</code></pre></div>


<p>年カレンダーの月にリンクを張ります。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">helpers</span> <span class="k">do</span>
   <span class="no">MONTHS</span> <span class="o">=</span> <span class="sx">%w(Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec)</span>  
   <span class="k">def</span> <span class="nf">cal</span><span class="p">(</span><span class="o">*</span><span class="n">date</span><span class="p">)</span>
     <span class="n">year</span><span class="p">,</span> <span class="n">mon</span> <span class="o">=</span> <span class="n">date</span>
     <span class="n">cal</span> <span class="o">=</span> <span class="sb">`cal </span><span class="si">#{</span><span class="n">mon</span><span class="si">}</span><span class="sb"> </span><span class="si">#{</span><span class="n">year</span><span class="si">}</span><span class="sb">`</span>
     <span class="n">cal</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/((</span><span class="si">#{</span><span class="no">MONTHS</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\w*)/</span><span class="p">)</span> <span class="k">do</span>
       <span class="sx">%Q{&lt;a href=&quot;/</span><span class="si">#{</span><span class="n">year</span><span class="si">}</span><span class="sx">/</span><span class="si">#{</span><span class="no">MONTHS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="vg">$2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sx">&quot;&gt;</span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="sx">&lt;/a&gt;}</span>
     <span class="k">end</span>
   <span class="k">end</span>
 <span class="k">end</span>
</code></pre></div>


<p>gsubで月の文字列にマッチさせます。ブラウザでhttp://localhost:4567/にアクセスします。Aprilのリンクをクリックして。4月のカレンダーが表示されるか確かめます。</p>

<p>ロードの度にTerminalに以下の警告が表れています。</p>

<div class="highlight"><pre><code class="ruby"> <span class="o">.</span><span class="n">/mycal</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span> <span class="ss">warning</span><span class="p">:</span> <span class="n">already</span> <span class="n">initialized</span> <span class="n">constant</span> <span class="no">MONTHS</span>
</code></pre></div>


<p>MONTHS定義をconfigureに移して対処します。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">configure</span> <span class="k">do</span>
   <span class="no">MONTHS</span> <span class="o">=</span> <span class="sx">%w(Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec)</span>  
 <span class="k">end</span>
</code></pre></div>


<p>configureブロックのコードは最初に一度起動されるだけです。ctrl+cでWebサーバを停止し、ruby mycal.rbで再起動して有効にします。</p>

<p>layoutをバナーとメインに分けます。バナーにはタイトルと前年・翌年のリンクを置きます。</p>

<div class="highlight"><pre><code class="ruby"> <span class="cp">__END__</span>
<span class="cp"> @@layout</span>
<span class="cp"> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="cp">   &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="cp"> &lt;html&gt;</span>
<span class="cp">   &lt;head&gt;</span>
<span class="cp">     &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span>
<span class="cp">     &lt;title&gt;mycal&lt;/title&gt;</span>
<span class="cp">     </span>
<span class="cp">   &lt;/head&gt;</span>
<span class="cp">   &lt;div id=&quot;banner&quot;&gt;</span>
<span class="cp">     &lt;h1&gt;&lt;a id=&#39;title&#39; href=&#39;/&#39;&gt;Web Calendar&lt;/a&gt;&lt;/h1&gt;</span>
<span class="cp">     &lt;div id=&quot;year_pred&quot;&gt;&lt;a href=&quot;/&lt;%= @year-1 %&gt;&quot;&gt;Previous Year&lt;/a&gt;&lt;/div&gt;</span>
<span class="cp">     &lt;div id=&quot;year_next&quot;&gt;&lt;a href=&quot;/&lt;%= @year+1 %&gt;&quot;&gt;Next Year&lt;/a&gt;&lt;/div&gt;</span>
<span class="cp">   &lt;/div&gt;</span>
<span class="cp">   &lt;div id=&quot;main&quot;&gt;</span>
<span class="cp">     &lt;pre&gt;&lt;%= yield %&gt;&lt;/pre&gt;    </span>
<span class="cp">   &lt;/div&gt;</span>
<span class="cp"> &lt;/html&gt;</span>
</code></pre></div>


<p>ブラウザでhttp://localhost:4567/にアクセスしてPrevious Year/Next Yearを適当にクリックします。タイトルをクリックして本年に戻るか確認します。</p>

<h2>Git</h2>

<p>そろそろGitでHerokuにデプロイしてみます。</p>

<p>念のためmycal.rbの全体を載せます。</p>

<div class="highlight"><pre><code class="ruby"> <span class="nb">require</span> <span class="s2">&quot;rubygems&quot;</span>
 <span class="nb">require</span> <span class="s2">&quot;sinatra&quot;</span>
 
 <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
   <span class="vi">@year</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">year</span>
   <span class="vi">@ycal</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="vi">@year</span><span class="p">)</span>
   <span class="n">erb</span> <span class="ss">:index</span>
 <span class="k">end</span>
 
 <span class="n">get</span> <span class="s1">&#39;/:year&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">year</span><span class="o">|</span>
   <span class="vi">@year</span> <span class="o">=</span> <span class="n">year</span><span class="o">.</span><span class="n">to_i</span>
   <span class="vi">@ycal</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="vi">@year</span><span class="p">)</span>
   <span class="n">erb</span> <span class="ss">:year</span>
 <span class="k">end</span>
 
 <span class="n">get</span> <span class="s1">&#39;/:year/:mon&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">ym</span><span class="o">|</span>
   <span class="vi">@year</span><span class="p">,</span> <span class="vi">@mon</span> <span class="o">=</span> <span class="n">ym</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">.</span><span class="n">to_i</span>  <span class="p">}</span>
   <span class="vi">@mcal</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="vi">@year</span><span class="p">,</span> <span class="vi">@mon</span><span class="p">)</span>
   <span class="n">erb</span> <span class="ss">:mon</span>
 <span class="k">end</span>
 
 <span class="n">configure</span> <span class="k">do</span>
   <span class="no">MONTHS</span> <span class="o">=</span> <span class="sx">%w(Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec)</span>  
 <span class="k">end</span>
 
 <span class="n">helpers</span> <span class="k">do</span>
   <span class="k">def</span> <span class="nf">cal</span><span class="p">(</span><span class="o">*</span><span class="n">date</span><span class="p">)</span>
     <span class="n">year</span><span class="p">,</span> <span class="n">mon</span> <span class="o">=</span> <span class="n">date</span>
     <span class="n">cal</span> <span class="o">=</span> <span class="sb">`cal </span><span class="si">#{</span><span class="n">mon</span><span class="si">}</span><span class="sb"> </span><span class="si">#{</span><span class="n">year</span><span class="si">}</span><span class="sb">`</span>
     <span class="n">cal</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/((</span><span class="si">#{</span><span class="no">MONTHS</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\w*)/</span><span class="p">)</span> <span class="k">do</span>
       <span class="sx">%Q{&lt;a href=&quot;/</span><span class="si">#{</span><span class="n">year</span><span class="si">}</span><span class="sx">/</span><span class="si">#{</span><span class="no">MONTHS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="vg">$2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sx">&quot;&gt;</span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="sx">&lt;/a&gt;}</span>
     <span class="k">end</span>
   <span class="k">end</span>
 <span class="k">end</span>
 
 <span class="cp">__END__</span>
<span class="cp"> @@layout</span>
<span class="cp"> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="cp">   &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="cp"> &lt;html&gt;</span>
<span class="cp">   &lt;head&gt;</span>
<span class="cp">     &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span>
<span class="cp">     &lt;title&gt;mycal&lt;/title&gt;</span>
<span class="cp">     </span>
<span class="cp">   &lt;/head&gt;</span>
<span class="cp">   &lt;body id=&quot;mycal&quot;&gt;</span>
<span class="cp">     &lt;div id=&quot;banner&quot;&gt;</span>
<span class="cp">       &lt;h1&gt;&lt;a id=&#39;title&#39; href=&#39;/&#39;&gt;Web Calendar&lt;/a&gt;&lt;/h1&gt;</span>
<span class="cp">       &lt;div id=&quot;year_pred&quot;&gt;&lt;a href=&quot;/&lt;%= @year-1 %&gt;&quot;&gt;Previous Year&lt;/a&gt;&lt;/div&gt;</span>
<span class="cp">       &lt;div id=&quot;year_next&quot;&gt;&lt;a href=&quot;/&lt;%= @year+1 %&gt;&quot;&gt;Next Year&lt;/a&gt;&lt;/div&gt;</span>
<span class="cp">     &lt;/div&gt;</span>
<span class="cp">     &lt;div id=&quot;main&quot;&gt;</span>
<span class="cp">       &lt;pre&gt;&lt;%= yield %&gt;&lt;/pre&gt;    </span>
<span class="cp">     &lt;/div&gt;</span>
<span class="cp">   &lt;/body&gt;</span>
<span class="cp"> &lt;/html&gt;</span>
<span class="cp"> </span>
<span class="cp"> @@index</span>
<span class="cp"> &lt;%= @ycal %&gt;</span>
<span class="cp"> </span>
<span class="cp"> @@year</span>
<span class="cp"> &lt;%= @ycal %&gt;</span>
<span class="cp"> </span>
<span class="cp"> @@mon</span>
<span class="cp"> &lt;%= @mcal %&gt;</span>
</code></pre></div>


<p>Gitのインストールはこの辺を参考にします。</p>

<p><a href="http://hikariworks.jp/blog/2008/06/18/macports%E3%81%A7git%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/">hikariworks::blog&#160;&#187;&#160; MacPortsでgitをインストール</a></p>

<p><a href="http://docs.heroku.com/git#installing">Heroku | Using Git</a></p>

<p>Webサーバを止めてGitをセットアップします。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">git</span> <span class="n">init</span>
</code></pre></div>


<p>.gitフォルダができます。</p>

<p>以下の内容のconfig.ruを作ります。</p>

<div class="highlight"><pre><code class="ruby"> <span class="nb">require</span> <span class="s1">&#39;mycal&#39;</span>
 <span class="n">run</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:Application</span>
</code></pre></div>




<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">echo</span> <span class="s2">&quot;require &#39;mycal&#39; ; run Sinatra::Application&quot;</span> <span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">ru</span>
</code></pre></div>


<p>Gitにファイルを追加します。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
</code></pre></div>


<p>コミットします。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;first commit&quot;</span>
</code></pre></div>


<h2>Heroku</h2>

<p>Herokuにアカウントが無ければ作ります。</p>

<p><a href="http://heroku.com/">Heroku</a></p>

<p>次にHeroku gemをインストールします。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">sudo</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">heroku</span>
</code></pre></div>


<p>Herokuではsshを使うので、ssh keyが無ければ作っておきます。</p>

<div class="highlight"><pre><code class="ruby"> <span class="sx">% ssh-keygen </span><span class="o">-</span><span class="n">t</span> <span class="n">rsa</span>
</code></pre></div>


<p>この辺を参考にします。</p>

<p><a href="http://docs.heroku.com/git#setting-up-ssh-public-keys">Heroku | Using Git</a></p>

<p><a href="http://www.atmarkit.co.jp/flinux/rensai/linuxtips/432makesshkey.html">＠IT：Linuxでsshの鍵を作成するには</a></p>

<p>Herokuにレポジトリを作ります。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">heroku</span> <span class="n">create</span>
</code></pre></div>


<p>任意のレポ名が割り当てられます。レポ名.heroku.comがurlになります。heroku create myappとして、レポ名を指定できます(mycalは取得されています)。heroku rename newnameでリネイムできます。</p>

<p>初回だけemailとpasswordを聞かれます。初回だけkeyのアップロードの要否が聞かれます。</p>

<p>そしてHerokuにコードをpushします。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">git</span> <span class="n">push</span> <span class="n">heroku</span> <span class="n">master</span>
</code></pre></div>


<p>次回以降masterは不要です。</p>

<p>これでデプロイできました。アプリケーションにアクセスしましょう。</p>

<div class="highlight"><pre><code class="ruby"> <span class="n">mycal</span><span class="o">%</span> <span class="n">heroku</span> <span class="nb">open</span>
</code></pre></div>


<p>以下のようなカレンダーが表示されたら成功です。</p>

<p><img src="http://img.f.hatena.ne.jp/images/fotolife/k/keyesberry/20090430/20090430100819.png" alt="image" /></p>

<p>(<a href="/2009/05/01/notitle/">次回に続く</a>)</p>

<p>(参考リンク)</p>

<p><a href="http://github.com/sinatra/heroku-sinatra-app/tree/master">sinatra's heroku-sinatra-app at master - GitHub</a></p>

<p><a href="http://docs.heroku.com/">Heroku | Heroku Documentation</a></p>

<p><a href="http://www.slideshare.net/myles_byrne/heroku-sinatra">Heroku &amp; Sinatra</a></p>

<p><a href="http://blog.zerosum.org/2008/7/2/clone-pastie-with-sinatra-datamapper-redux">zerosum dirt(nap) - Clone Pastie with Sinatra &amp; DataMapper 0.9</a></p>

<p><a href="http://herokugarden.com/">Heroku Garden</a></p>

<p><a href="http://www8.atwiki.jp/git_jp/pub/Documentation.ja/tutorial.html">git チュートリアル (バージョン 1.5.1 以降用)</a></p>

<p><a href="http://cheat.errtheblog.com/s/git">$ cheat git</a></p>


    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* foot */
      google_ad_slot = "7511276945";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <hr>
    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby.Sinatra.Git.Heroku #=> "Happy Web Development!"" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" data-text="Ruby.Sinatra.Git.Heroku #=> "Happy Web Development!"" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2009/04/27/Ruby-Shoes-2" title="Ruby+Shoesでスキャニメーションを作ろう！（その2)">&larr; Previous</a></li>
      
        <li><a href="/">Archive</a></li>
        <!--<li><a href="/archive.html">Archive</a></li>-->
      
        <li class="next"><a href="/2009/05/01/Ruby-Sinatra-Git-Heroku-Happy-Web-Development" title="Ruby.Sinatra.Git.Heroku #=> "Happy Web Development!"　(後編)">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'melborne'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span3">
    <div id="bookAd">
      <a href="/books/">
        <!--<img src="/assets/images/2012/start_ruby.jpg" alt="start_ruby" />-->
        <!--<img src="/assets/images/2012/jekyll_cover.jpg" alt="jekyll" />-->
        <!--<img src="/assets/images/2012/ruby_parallel_cover.png" alt="ruby_parallel" />-->
        <!--<img src="/assets/images/2012/js_oop_cover.png" alt="js_oop" />-->
        <!--<img src="/assets/images/2012/rack_cover.png" alt="rack" />-->
        <!--<img src="/assets/images/2013/02/ruby_object_cover.png" alt="ruby_object" />-->
        <img src="/assets/images/2013/03/ruby_trivia_cover.png" alt="ruby_trivia" />
      </a>
      <p id="comment">100円で好評発売中！<br/><a href="/books/">M'ELBORNE BOOKS</a></p>
    </div>

    <hr />
    
      <ul class="tag_box inline">
      
      


  
     
    	<li><a href="/tags.html#ruby-ref">ruby <span>117</span></a></li>
     
    	<li><a href="/tags.html#sinatra-ref">sinatra <span>8</span></a></li>
     
    	<li><a href="/tags.html#webapp-ref">webapp <span>14</span></a></li>
     
    	<li><a href="/tags.html#heroku-ref">heroku <span>6</span></a></li>
    
  



      </ul>
      <hr />
    

    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby.Sinatra.Git.Heroku #=> "Happy Web Development!"" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" data-text="Ruby.Sinatra.Git.Heroku #=> "Happy Web Development!"" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2009/04/30/Ruby-Sinatra-Git-Heroku-Happy-Web-Development/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>

    <div class="ad" id="sideAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* sidebar */
      google_ad_slot = "0672114662";
      google_ad_width = 160;
      google_ad_height = 600;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>
  </div>
</div>


      </div>

      <footer>
        <p><a rel="license" href="http://creativecommons.org/licenses/by-nc/2.1/jp/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/2.1/jp/88x31.png" /></a>  kyoendo 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>        </p>
      </footer>

    </div> <!-- /container -->

    

    <script type="text/javascript">
      if (location.hostname != 'localhost') {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-288751-18']);
        _gaq.push(['_trackPageview']);
  
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      };
    </script>

    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <script src="/assets/javascripts/jquery-1.7.2.min.js"></script>
    <script src="/assets/javascripts/lightbox.js"></script>

    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>
  </body>
</html>

