
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    
      <title>エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩</title>
    
    <meta name="description" content="" />
    <meta name="author" content="kyoendo" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter-ext/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/themes/twitter-ext/css/style.css?body=1" rel="stylesheet" type="text/css" media="all" />
    <link href="/assets/themes/twitter-ext/css/syntax.css" rel="stylesheet" type="text/css" />
    <link href="/assets/themes/twitter-ext/css/lightbox.css" rel="stylesheet" />
    <link media="only screen and (max-device-width: 480px)" href="/assets/themes/twitter-ext/css/iphone.css" type="text/css" rel="stylesheet" />
    <!--<link media="only screen and (device-width: 768px)" href="/assets/themes/twitter-ext/css/ipad.css" type="text/css" rel="stylesheet" />-->
    <!--<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />-->
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />-->
<!--<script type="text/x-mathjax-config">-->
  <!--MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });-->
<!--</script>-->
<!--<script type="text/javascript"-->
  <!--src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">-->
<!--</script>-->
  </head>
  <body>
    <div id="fb-root"></div>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="avatar" href="/">
            <img src="http://gravatar.com/avatar/97aa01a6f87da85251be77792dec1d9c?s=80" height="75" width="75" class="avatar" />
          </a>
          <a class="brand" href="/">hp12c</a>
          <div id='rss'>
            <a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon32x32.png" alt="" style="border:0"/></a><a href="http://feeds.feedburner.com/github/melborne" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"></a>
            <!--<a href="/atom.xml" id="rss">-->
              <!--<img src="/assets/images/site/rss.png" alt="rss" title="RSS" height="22" width="22" />-->
            <!--</a>-->
          </div>
          <ul class="nav">
            <li>
            <a class="books" href="/books/">Books</a>
            </li>
            <li>
              <a class="myproducts" href="http://welove.herokuapp.com/?keyword=merborne">Products</a>
            </li>
            
            
            


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
    	
      <li><a href="/tags.html">Tags</a></li>
    	
    
  








            <li class='site'>
              <a href="https://twitter.com/merborne" id="twitter">
                <img src="/assets/images/site/twitter.png" alt="twitter" title="@merborne on Twitter" height="32" width="32" />
              </a>
            </li>
            <li class='site'>
              <a href="https://github.com/melborne" id="github">
                <img src="/assets/images/site/github.png" alt="github" title="@melborne on GitHub" height="24" width="24" />
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header span8">
  <div class="date"><span>12 November 2012</span></div>
  <h1 class='page-title'><a href="/2012/11/12/epub-tutorial">エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩</a> <small>  </small></h1>
</div>

<div class="row">
  <div class="span9">
    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* hp12c */
      google_ad_slot = "7055414638";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <p>ソフトウェア（プログラム）は中間を飲み込みます。ソフトウェアによって電話交換手が消えました。株仲買人が消えました。写植屋さんが消えました。Amazonの登場で書店の経営は厳しさを増しています。ソフトウェアは市場において、発信者と受信者が円滑にコミュニケートするためのいくつもの障壁を、次々と飲み込んでいるのです。</p>

<p>そして電子書籍です。EPUBです。EPUBは言うなればソフトウェアで構成された電子出版社です。それは本の著者と読者を直接結びます。それは既存の出版社は言うに及ばず、Amazonにとっても脅威となりうる存在なのです...</p>

<hr />

<p>と言ってみたものの...</p>

<p>僕自身はEPUBのことがよくわかっていません^ ^;</p>

<p>でも、いつまでもそう言ってもいられないでしょう。</p>

<p>そんなわけで...</p>

<p>EPUBについて最初の一歩を踏み出したので、ここに記録としてまとめておきます。環境はMac OSX 10.8.2です。長い記事になります。</p>

<h2>EPUB</h2>

<p>WikipediaはEPUBについて次のように書いています。</p>

<pre><code>EPUBは、HTMLやウェブブラウザのオープン性を保持しつつ、インターネット接続が切断された状態の携帯情報端末 (PDA) やノートパソコンなどでも電子書籍の閲覧が継続できるようにダウンロード配信を前提にパッケージ化された、XHTMLのサブセット的なファイル・フォーマット規格であり、画面の大きさに合わせて表示を調整する「リフロー機能」が特徴である。
</code></pre>

<p><a href="http://ja.wikipedia.org/wiki/EPUB" title="EPUB - Wikipedia">EPUB - Wikipedia</a></p>

<p>やっぱりよくわかりませんが、たぶんそれは、XHTMLフォーマットで書かれた文章をZIPか何かでまとめたアーカイブファイルだと理解します。</p>

<h2>エラーメッセージから学ぶ</h2>

<p>古くからの格言の一つに「EPUBのことはEpubcheckに聞け」というものがあります。EPUBがわからないので、この格言に従いEpubcheckに聞いてみることにします。</p>

<h2>Epubcheckのダウンロード</h2>

<p>以下のサイトからEpubcheckをダウンロードして、EPUBを作るディレクトリ下に置きます。</p>

<p><a href="http://code.google.com/p/epubcheck/downloads/list" title="Downloads - epubcheck - Validation tool for EPUB - Google Project Hosting">Downloads - epubcheck - Validation tool for EPUB</a></p>

<h2>コンテンツの準備</h2>

<p>コンテンツがなければ話になりません。</p>

<p>表紙、目次、チャプター１，２からなるチャーリーの物語を用意します。XHTMLでコンテンツを作るなんて最初から死ににいくようなものですから、ここではMarkdownを使います。</p>

<div class="highlight"><pre><code class="bash">% touch front.md toc.md chapter<span class="o">{</span>01,02<span class="o">}</span>.md        
% tree
.
├── chapter01.md
├── chapter02.md
├── front.md
└── toc.md
</code></pre></div>


<p>各ファイルの中身です。</p>

<p>front.md</p>

<div class="highlight"><pre><code class="xml"># チャーリーの本の冒険

## チャーリー　著
</code></pre></div>


<p>toc.md</p>

<div class="highlight"><pre><code class="xml"># 目次

## チャーリーの本の冒険

[第一章：チャーリーについて](chapter01.xhtml)

[第二章：本の冒険について](chapter02.xhtml)
</code></pre></div>


<p>chapter01.md</p>

<div class="highlight"><pre><code class="xml"># 第一章：チャーリーについて

## チャーリーの呪文
チャーリーが呪文を唱えた。

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

## チャーリーのいびき
チャーリーのいびきはうるさい。

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
</code></pre></div>


<p>chapter02.md</p>

<div class="highlight"><pre><code class="xml"># 第二章：本の冒険について

## 本
チャーリーが乱暴に本を開いたら、大きな音がした。
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

## 冒険
そして、チャーリーは長い長い冒険に出かけた。長い長い歌を口ずさみながら。Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
</code></pre></div>


<h2>MarkdownからXHTMLへ</h2>

<p>ここでは<a href="http://maruku.rubyforge.org/index.html" title="Maruku: a Markdown-superset interpreter">Maruku</a>というRuby製のconverterを使って、先のコンテンツをXHTMLに変換します。なければ<code>gem install maruku</code>します。</p>

<div class="highlight"><pre><code class="bash">% maruku front.md
% maruku toc.md
% maruku chapter01.md
% maruku chapter02.md
</code></pre></div>


<p>それぞれ同名のhtmlファイルができているので、それらをxhtmlにリネイムします。</p>

<div class="highlight"><pre><code class="bash">% mv front.html front.xhtml
% mv toc.html toc.xhtml
% mv chapter01.html chapter01.xhtml
% mv chapter02.html chapter02.xhtml
</code></pre></div>


<p>変換後のファイルは次のようになっています。front.xhtmlだけ示します。</p>

<p>front.xhtml</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE html PUBLIC</span>
<span class="cp">    &quot;-//W3C//DTD XHTML 1.1 plus MathML 2.0 plus SVG 1.1//EN&quot;</span>
<span class="cp">    &quot;http://www.w3.org/2002/04/xhtml-math-svg/xhtml-math-svg.dtd&quot;&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xml:lang=</span><span class="s">&#39;en&#39;</span> <span class="na">xmlns:svg=</span><span class="s">&#39;http://www.w3.org/2000/svg&#39;</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.w3.org/1999/xhtml&#39;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;&lt;meta</span> <span class="na">content=</span><span class="s">&#39;application/xhtml+xml;charset=utf-8&#39;</span> <span class="na">http-equiv=</span><span class="s">&#39;Content-type&#39;</span> <span class="nt">/&gt;&lt;title&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&#39;id1&#39;</span><span class="nt">&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&#39;id2&#39;</span><span class="nt">&gt;</span>チャーリー　著<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>
</code></pre></div>


<h2>charlie.epubにパッケージ化</h2>

<p>さあ、コンテンツが用意できたので、ZIPを使って<code>charlie.epub</code>というファイルにまとめます。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub *.xhtml
  adding: chapter01.xhtml <span class="o">(</span>deflated 62%<span class="o">)</span>
  adding: chapter02.xhtml <span class="o">(</span>deflated 58%<span class="o">)</span>
  adding: front.xhtml <span class="o">(</span>deflated 24%<span class="o">)</span>
  adding: toc.xhtml <span class="o">(</span>deflated 38%<span class="o">)</span>
</code></pre></div>


<h2>Epubcheckで検証</h2>

<p>さあEPUBファイルができたので、Epubcheckしてみます。</p>

<div class="highlight"><pre><code class="bash">% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

ERROR: charlie.epub: Length of the first filename in archive must be 8, but was 15
ERROR: charlie.epub: Required META-INF/container.xml resource is missing

Check finished with warnings or errors
</code></pre></div>


<p>２つのエラーが報告されました。アーカイブの最初のファイル名は８文字でなければならないと言っています。また、<code>META-INF/container.xml</code>が無いと言っています。</p>

<h2>mimetype</h2>

<p>調べたところ<code>mimetype</code>という８文字のファイルが必要なことがわかりました。追加します。</p>

<div class="highlight"><pre><code class="bash">% touch mimetype
% zip charlie.epub mimetype
  adding: mimetype <span class="o">(</span>stored 0%<span class="o">)</span>
</code></pre></div>


<p>２つ目のエラーに対応する前にもう一度Epubcheckチェックします。</p>

<div class="highlight"><pre><code class="bash">% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

ERROR: charlie.epub: Length of the first filename in archive must be 8, but was 15
ERROR: charlie.epub: Required META-INF/container.xml resource is missing

Check finished with warnings or errors
</code></pre></div>


<p>変化がありません。アーカイブの中身を見てみます。</p>

<div class="highlight"><pre><code class="bash">% unzip -v charlie.epub 
Archive:  charlie.epub
 Length   Method    Size  Ratio   Date   Time   CRC-32    Name
 --------  ------  ------- -----   ----   ----   ------    ----
 1134  Defl:N      426  62%  11-11-12 23:01  c908417c  chapter01.xhtml
 1168  Defl:N      493  58%  11-11-12 23:01  6c07547b  chapter02.xhtml
   72  Defl:N       55  24%  11-11-12 23:00  3f0e329a  front.xhtml
  210  Defl:N      131  38%  11-11-12 23:01  7f9384c2  toc.xhtml
    0  Stored        0   0%  11-11-12 23:08  00000000  mimetype
 --------      -------  ---                            -------
 2584             1105  57%                            5 files
</code></pre></div>


<p>mimetypeが先頭ファイルになってませんでした。</p>

<p>コンテンツファイル群をディレクトリに放り投げて対応します。ディレクトリ名はなんでもいいですが、「Open EBook Publication Structure」に基いて<code>OEBPS</code>とします。</p>

<div class="highlight"><pre><code class="bash">% mkdir OEBPS
% mv *.xhtml OEBPS                                         
% tree
.
├── OEBPS
│   ├── chapter01.xhtml
│   ├── chapter02.xhtml
│   ├── front.xhtml
│   └── toc.xhtml
├── charlie.epub
└── mimetype
</code></pre></div>


<p>アーカイブからコンテンツファイルを削除し、OEBPS下のものを追加します。</p>

<div class="highlight"><pre><code class="bash">% zip -d charlie.epub front.xhtml toc.xhtml chapter01.xhtml chapter02.xhtml
  deleting: chapter01.xhtml
  deleting: chapter02.xhtml
  deleting: front.xhtml
  deleting: toc.xhtml

% zip charlie.epub OEBPS/*
  adding: OEBPS/chapter01.xhtml <span class="o">(</span>deflated 62%<span class="o">)</span>
  adding: OEBPS/chapter02.xhtml <span class="o">(</span>deflated 58%<span class="o">)</span>
  adding: OEBPS/front.xhtml <span class="o">(</span>deflated 24%<span class="o">)</span>
  adding: OEBPS/toc.xhtml <span class="o">(</span>deflated 38%<span class="o">)</span>

% unzip -v charlie.epub
Archive:  charlie.epub Length   Method    Size  Ratio   Date   Time   CRC-32    Name
--------  ------  ------- -----   ----   ----   ------    ----
   0  Stored        0   0%  11-11-12 23:08  00000000  mimetype
1134  Defl:N      426  62%  11-11-12 23:01  c908417c  OEBPS/chapter01.xhtml
1168  Defl:N      493  58%  11-11-12 23:01  6c07547b  OEBPS/chapter02.xhtml
  72  Defl:N       55  24%  11-11-12 23:00  3f0e329a  OEBPS/front.xhtml
 210  Defl:N      131  38%  11-11-12 23:01  7f9384c2  OEBPS/toc.xhtml
--------      -------  ---                            -------
2584             1105  57%                            5 files
</code></pre></div>


<p>再度検証します。</p>

<div class="highlight"><pre><code class="bash">% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

ERROR: charlie.epub: Extra field length <span class="k">for </span>first filename must be 0, but was 28
ERROR: charlie.epub: Required META-INF/container.xml resource is missing

Check finished with warnings or errors
</code></pre></div>


<p>mimetypeのExtra fieldの長さが０じゃないと言っています。これに対処するには、zipコマンドに-X(大文字)を付ければいいようです<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>。</p>

<div class="highlight"><pre><code class="bash">% zip -X charlie.epub mimetype
  updating: mimetype <span class="o">(</span>stored 0%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

ERROR: charlie.epub: Mimetype contains wrong <span class="nb">type</span> <span class="o">(</span>application/epub+zip expected<span class="o">)</span>.
ERROR: charlie.epub: Required META-INF/container.xml resource is missing

Check finished with warnings or errors
</code></pre></div>


<p>こんどはmimetypeに<code>application/epub+zip</code>と書けといっているので、従います。</p>

<div class="highlight"><pre><code class="bash">% <span class="nb">echo </span>application/epub+zip &gt; mimetype 
% zip -X charlie.epub mimetype                                       
updating: mimetype <span class="o">(</span>stored 0%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

ERROR: charlie.epub: Required META-INF/container.xml resource is missing

Check finished with warnings or errors
</code></pre></div>


<h2>META-INF/container.xml</h2>

<p>最初のエラーが解消できたので、次のエラーに対処して<code>META-INF/container.xml</code>ファイルを追加します。</p>

<div class="highlight"><pre><code class="bash">% mkdir META-INF
% touch META-INF/container.xml
% zip charlie.epub META-INF/container.xml
  adding: META-INF/container.xml <span class="o">(</span>stored 0%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

ERROR: charlie.epub/META-INF/container.xml<span class="o">(</span>1,1<span class="o">)</span>: Premature end of file.
ERROR: charlie.epub/META-INF/container.xml: Premature end of file.
ERROR: charlie.epub/META-INF/container.xml: No rootfile with media <span class="nb">type</span> <span class="s1">&#39;application/oebps-package+xml&#39;</span>

Check finished with warnings or errors
</code></pre></div>


<p>お前のファイルは全然ダメだ、rootfileもないし、と言っています。</p>

<p>ググったところcontainer.xmlはコンテンツの所在を示すもののようです。具体的には、コンテンツのメタデータとなるファイル<code>content.opf</code>のパスとメディアタイプをroutefileとして指定します。</p>

<p>次のような内容にします。</p>

<p>container.xml</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;urn:oasis:names:tc:opendocument:xmlns:container&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;rootfiles&gt;</span>
    <span class="nt">&lt;rootfile</span> <span class="na">full-path=</span><span class="s">&quot;OEBPS/content.opf&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/oebps-package+xml&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/rootfiles&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</code></pre></div>


<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub META-INF/container.xml
  updating: META-INF/container.xml <span class="o">(</span>deflated 34%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

ERROR: charlie.epub/OEBPS/content.opf: 
ERROR: charlie.epub/OEBPS/content.opf: Version not found
Check finished with warnings or errors
</code></pre></div>


<h2>OEBPS/content.opf</h2>

<p>指し示した<code>OEBPS/content.opf</code>が無いと言っているようなので、次のような内容で用意します。</p>

<p>content.opf</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span> <span class="na">unique-identifier=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;/package&gt;</span>
</code></pre></div>


<p><code>unique-identifier</code>はこのパッケージにおける固有IDのようです。適当に付けます。</p>

<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/content.opf            
  adding: OEBPS/content.opf <span class="o">(</span>stored 0%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>4,11<span class="o">)</span>: element <span class="s2">&quot;package&quot;</span> incomplete; missing required element <span class="s2">&quot;metadata&quot;</span>
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>2,88<span class="o">)</span>: assertion failed: package element unique-identifier attribute does not resolve to a dc:identifier element <span class="o">(</span>given reference was <span class="s1">&#39;BookId&#39;</span><span class="o">)</span>
ERROR: charlie.epub/OEBPS/content.opf: unique-identifier attribute in package element must reference an existing identifier element id
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/front.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/chapter01.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/chapter02.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/toc.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file

Check finished with warnings or errors
</code></pre></div>


<p>幾つかのエラーと幾つかの警告がでました。順番に対処します。</p>

<p>まずはpackageに<code>metadata</code>という要素がないといっているので、追加します。それからpackageの<code>unique-identifier</code>が<code>identifier</code>要素を参照してないといったようなことを言っているので、そう言った要素を追加します。</p>

<p>content.opf</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span> <span class="na">unique-identifier=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;metadata</span> <span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span> <span class="na">xmlns:dcterms=</span><span class="s">&quot;http://purl.org/dc/terms/&quot;</span> <span class="na">xmlns:opf=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dc:identifier</span> <span class="na">id=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>http://charlie.com/BN001<span class="nt">&lt;/dc:identifier&gt;</span>

  <span class="nt">&lt;/metadata&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</code></pre></div>


<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/content.opf
  updating: OEBPS/content.opf <span class="o">(</span>deflated 43%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>6,14<span class="o">)</span>: element <span class="s2">&quot;metadata&quot;</span> incomplete; missing required elements <span class="s2">&quot;dc:language&quot;</span> and <span class="s2">&quot;dc:title&quot;</span>
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>7,11<span class="o">)</span>: element <span class="s2">&quot;package&quot;</span> incomplete; missing required element <span class="s2">&quot;manifest&quot;</span>
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>3,140<span class="o">)</span>: assertion failed: package dcterms:modified meta element must occur exactly once
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/front.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/chapter01.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/chapter02.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/toc.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file

Check finished with warnings or errors
</code></pre></div>


<p><code>dc:language</code>と<code>dc:title</code>要素がmetadataに無い、<code>manifest</code>要素がpackageに無い、<code>dcterms:modified</code>メタ要素が無いと言っています。また、コンテンツに係るXHTMLファイルがあるのに、ここで宣言されてないと警告しています。まずはエラーに対処します。</p>

<p>content.opf</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span> <span class="na">unique-identifier=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;metadata</span> <span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span> <span class="na">xmlns:dcterms=</span><span class="s">&quot;http://purl.org/dc/terms/&quot;</span> <span class="na">xmlns:opf=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dc:identifier</span> <span class="na">id=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>http://charlie.com/BN001<span class="nt">&lt;/dc:identifier&gt;</span>
    <span class="nt">&lt;dc:title&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/dc:title&gt;</span>
    <span class="nt">&lt;dc:language&gt;</span>ja<span class="nt">&lt;/dc:language&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;dcterms:modified&quot;</span><span class="nt">&gt;</span>2012-11-12T00:00:00Z<span class="nt">&lt;/meta&gt;</span>
  <span class="nt">&lt;/metadata&gt;</span>
  <span class="nt">&lt;manifest&gt;</span>
  
  <span class="nt">&lt;/manifest&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</code></pre></div>


<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/content.opf
  updating: OEBPS/content.opf <span class="o">(</span>deflated 41%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>11,14<span class="o">)</span>: element <span class="s2">&quot;manifest&quot;</span> incomplete; missing required element <span class="s2">&quot;item&quot;</span>
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>12,11<span class="o">)</span>: element <span class="s2">&quot;package&quot;</span> incomplete; missing required element <span class="s2">&quot;spine&quot;</span>
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>9,13<span class="o">)</span>: assertion failed: Exactly one manifest item must <span class="nb">declare </span>the <span class="s1">&#39;nav&#39;</span> property <span class="o">(</span>number of <span class="s1">&#39;nav&#39;</span> items: 0<span class="o">)</span>.
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/front.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/chapter01.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/chapter02.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file
WARNING: charlie.epub: item <span class="o">(</span>OEBPS/toc.xhtml<span class="o">)</span> exists in the zip file, but is not declared in the OPF file

Check finished with warnings or errors
</code></pre></div>


<p><code>item</code>要素がmanifestに、<code>spine</code>要素がpackageに無いと言っています。また、<code>nav</code>属性の１つのmanifest要素が無いと言っています。どうやらmanifestではコンテンツファイルにidを付けてリストアップすればいいようです。また<code>nav</code>要素は目次を作るためのファイルを指定するもののようです。これらを追加します。</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span> <span class="na">unique-identifier=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;metadata</span> <span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span> <span class="na">xmlns:dcterms=</span><span class="s">&quot;http://purl.org/dc/terms/&quot;</span> <span class="na">xmlns:opf=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dc:identifier</span> <span class="na">id=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>http://charlie.com/BN001<span class="nt">&lt;/dc:identifier&gt;</span>
    <span class="nt">&lt;dc:title&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/dc:title&gt;</span>
    <span class="nt">&lt;dc:language&gt;</span>ja<span class="nt">&lt;/dc:language&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;dcterms:modified&quot;</span><span class="nt">&gt;</span>2012-11-12T00:00:00Z<span class="nt">&lt;/meta&gt;</span>
  <span class="nt">&lt;/metadata&gt;</span>
  <span class="nt">&lt;manifest&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">properties=</span><span class="s">&quot;nav&quot;</span> <span class="na">id=</span><span class="s">&quot;nav&quot;</span> <span class="na">href=</span><span class="s">&quot;nav.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;front&quot;</span> <span class="na">href=</span><span class="s">&quot;front.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;toc&quot;</span> <span class="na">href=</span><span class="s">&quot;toc.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;chapter01&quot;</span> <span class="na">href=</span><span class="s">&quot;chapter01.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;chapter02&quot;</span> <span class="na">href=</span><span class="s">&quot;chapter02.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/manifest&gt;</span>
  <span class="nt">&lt;spine&gt;</span>
  
  <span class="nt">&lt;/spine&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</code></pre></div>


<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/content.opf
updating: OEBPS/content.opf <span class="o">(</span>deflated 57%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
ERROR: charlie.epub/OEBPS/content.opf<span class="o">(</span>18,11<span class="o">)</span>: element <span class="s2">&quot;spine&quot;</span> incomplete; missing required element <span class="s2">&quot;itemref&quot;</span>
ERROR: charlie.epub: File OEBPS/nav.xhtml is missing in the package.
ERROR: charlie.epub/OEBPS/front.xhtml: Obsolete or irregular DOCTYPE statement. External DTD entities are not allowed. Use <span class="s1">&#39;&lt;!DOCTYPE html&gt;&#39;</span> instead.
ERROR: charlie.epub/OEBPS/front.xhtml<span class="o">(</span>339,2<span class="o">)</span>: External entities are not allowed. External entity declaration found: %xhtml-qname-extra.mod
ERROR: charlie.epub/OEBPS/front.xhtml<span class="o">(</span>388,36<span class="o">)</span>: External entities are not allowed. External entity declaration found: %SVG.dtd
ERROR: charlie.epub/OEBPS/front.xhtml<span class="o">(</span>1,1<span class="o">)</span>: Entity <span class="s1">&#39;%SVG.dtd&#39;</span> is undeclared
ERROR: charlie.epub/OEBPS/front.xhtml<span class="o">(</span>60,31<span class="o">)</span>: External entities are not allowed. External entity declaration found: %svg-model.mod
ERROR: charlie.epub/OEBPS/front.xhtml<span class="o">(</span>65,33<span class="o">)</span>: External entities are not allowed. External entity declaration found: %svg-attribs.mod

（中略）

ERROR: charlie.epub/OEBPS/chapter02.xhtml<span class="o">(</span>1,1<span class="o">)</span>: Entity <span class="s1">&#39;%ent-mmlextra&#39;</span> is undeclared
ERROR: charlie.epub/OEBPS/chapter02.xhtml<span class="o">(</span>2144,37<span class="o">)</span>: External entities are not allowed. External entity declaration found: %ent-mmlalias
ERROR: charlie.epub/OEBPS/chapter02.xhtml<span class="o">(</span>1,1<span class="o">)</span>: Entity <span class="s1">&#39;%ent-mmlalias&#39;</span> is undeclared
ERROR: charlie.epub/OEBPS/chapter02.xhtml<span class="o">(</span>6,87<span class="o">)</span>: value of attribute <span class="s2">&quot;http-equiv&quot;</span> is invalid; must be a string matching the regular expression <span class="s2">&quot;([Dd][Ee][Ff][Aa][Uu][Ll][Tt]\-[Ss][Tt][Yy][Ll][Ee])|([Rr][Ee][Ff][Rr][Ee][Ss][Hh])&quot;</span>

Check finished with warnings or errors
</code></pre></div>


<p>コンテンツファイルに関し大量のエラーが出ましたが、まずは、spineに<code>itemref</code>要素がない、目次ファイル<code>nav.xhtml</code>ファイルがないというエラーに対処します。spineは「本の背」のことですが、ここでmanifestで宣言したファイルの並び順を指定するようです。</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span> <span class="na">unique-identifier=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;metadata</span> <span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span> <span class="na">xmlns:dcterms=</span><span class="s">&quot;http://purl.org/dc/terms/&quot;</span> <span class="na">xmlns:opf=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dc:identifier</span> <span class="na">id=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>http://charlie.com/BN001<span class="nt">&lt;/dc:identifier&gt;</span>
    <span class="nt">&lt;dc:title&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/dc:title&gt;</span>
    <span class="nt">&lt;dc:language&gt;</span>ja<span class="nt">&lt;/dc:language&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;dcterms:modified&quot;</span><span class="nt">&gt;</span>2012-11-12T00:00:00Z<span class="nt">&lt;/meta&gt;</span>
  <span class="nt">&lt;/metadata&gt;</span>
  <span class="nt">&lt;manifest&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">properties=</span><span class="s">&quot;nav&quot;</span> <span class="na">id=</span><span class="s">&quot;nav&quot;</span> <span class="na">href=</span><span class="s">&quot;nav.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;front&quot;</span> <span class="na">href=</span><span class="s">&quot;front.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;toc&quot;</span> <span class="na">href=</span><span class="s">&quot;toc.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;chapter01&quot;</span> <span class="na">href=</span><span class="s">&quot;chapter01.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;chapter02&quot;</span> <span class="na">href=</span><span class="s">&quot;chapter02.xhtml&quot;</span> <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/manifest&gt;</span>
  <span class="nt">&lt;spine&gt;</span>
    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;front&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;toc&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;chapter01&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;chapter02&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/spine&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</code></pre></div>


<p>次に、nav.xhtmlファイルを作ります。</p>

<div class="highlight"><pre><code class="bash">% touch OEBPS/nav.xhtml
</code></pre></div>


<h2>コンテンツファイルの修正</h2>

<p>さて、次にコンテンツファイルを直します。不要なタグを削除し<code>html</code>タグにxmlns, xml:langを指定します。</p>

<p>front.xhtml</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&#39;id1&#39;</span><span class="nt">&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&#39;id2&#39;</span><span class="nt">&gt;</span>チャーリー　著<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>toc.xhtml</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>目次<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&#39;id1&#39;</span><span class="nt">&gt;</span>目次<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&#39;id2&#39;</span><span class="nt">&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">&#39;chapter01.xhtml&#39;</span><span class="nt">&gt;</span>第一章：チャーリーについて<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>

    <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">&#39;chapter02.xhtml&#39;</span><span class="nt">&gt;</span>第二章：本の冒険について<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>chapter01.xhtml</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>第一章：チャーリーについて<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&#39;id1&#39;</span><span class="nt">&gt;</span>第一章：チャーリーについて<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&#39;id2&#39;</span><span class="nt">&gt;</span>チャーリーの呪文<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;p&gt;</span>チャーリーが呪文を唱えた。<span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;p&gt;</span>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&#39;id3&#39;</span><span class="nt">&gt;</span>チャーリーのいびき<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;p&gt;</span>チャーリーのいびきはうるさい。<span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;p&gt;</span>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>chapter02.xhtml</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>第二章：本の冒険について<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&#39;id1&#39;</span><span class="nt">&gt;</span>第二章：本の冒険について<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&#39;id2&#39;</span><span class="nt">&gt;</span>本<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;p&gt;</span>チャーリーが乱暴に本を開いたら、大きな音がした。 Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&#39;id3&#39;</span><span class="nt">&gt;</span>冒険<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;p&gt;</span>そして、チャーリーは長い長い冒険に出かけた。長い長い歌を口ずさみながら。Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>さて準備ができたので、検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/*
updating: OEBPS/chapter01.xhtml <span class="o">(</span>deflated 60%<span class="o">)</span>
updating: OEBPS/chapter02.xhtml <span class="o">(</span>deflated 56%<span class="o">)</span>
updating: OEBPS/front.xhtml <span class="o">(</span>deflated 33%<span class="o">)</span>
updating: OEBPS/toc.xhtml <span class="o">(</span>deflated 35%<span class="o">)</span>
updating: OEBPS/content.opf <span class="o">(</span>deflated 60%<span class="o">)</span>
updating: OEBPS/nav.xhtml <span class="o">(</span>stored 0%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
ERROR: charlie.epub/OEBPS/nav.xhtml<span class="o">(</span>1,1<span class="o">)</span>: Premature end of file.
ERROR: charlie.epub/OEBPS/nav.xhtml: Premature end of file.

Check finished with warnings or errors
</code></pre></div>


<p>コンテンツファイルに対するエラーが解消しました。</p>

<h2>nav.xhtml</h2>

<p>次に、<code>nav.xhtml</code>のエラーに対処します。まずは、先に作った<code>toc.xhtml</code>と同じような構造にします。</p>

<p>nav.xhtml</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>目次<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/nav.xhtml 
updating: OEBPS/nav.xhtml <span class="o">(</span>deflated 16%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
ERROR: charlie.epub/OEBPS/nav.xhtml<span class="o">(</span>7,7<span class="o">)</span>: assertion failed: Exactly one <span class="s1">&#39;toc&#39;</span> nav element must be present

Check finished with warnings or errors
</code></pre></div>


<p><code>toc</code>というnav要素が１つ必要だと言っているので、追加します。</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>目次<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;nav</span> <span class="na">xmlns:epub=</span><span class="s">&quot;http://www.idpf.org/2007/ops&quot;</span> <span class="na">epub:type=</span><span class="s">&quot;toc&quot;</span><span class="nt">&gt;&lt;/nav&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/nav.xhtml                                   
updating: OEBPS/nav.xhtml <span class="o">(</span>deflated 27%<span class="o">)</span>

% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
ERROR: charlie.epub/OEBPS/nav.xhtml<span class="o">(</span>8,74<span class="o">)</span>: element <span class="s2">&quot;nav&quot;</span> incomplete; missing required element <span class="s2">&quot;ol&quot;</span>

Check finished with warnings or errors
</code></pre></div>


<p><code>ol</code>要素が無いと言っています。<code>ol</code>要素で目次項目をリストアップするようです。対処します。</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>目次<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;nav</span> <span class="na">xmlns:epub=</span><span class="s">&quot;http://www.idpf.org/2007/ops&quot;</span> <span class="na">epub:type=</span><span class="s">&quot;toc&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1&gt;</span>チャーリーの本の冒険<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;ol&gt;</span>
        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;front.xhtml&quot;</span><span class="nt">&gt;</span>表紙<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;toc.xhtml&quot;</span><span class="nt">&gt;</span>目次<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;chapter01.xhtml&quot;</span><span class="nt">&gt;</span>第一章：チャーリーについて<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;chapter02.xhtml&quot;</span><span class="nt">&gt;</span>第二章：本の冒険について<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
      <span class="nt">&lt;/ol&gt;</span>
    <span class="nt">&lt;/nav&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>検証します。</p>

<div class="highlight"><pre><code class="bash">% zip charlie.epub OEBPS/nav.xhtml 
updating: OEBPS/nav.xhtml <span class="o">(</span>deflated 45%<span class="o">)</span>
% java -jar epubcheck-3.0-RC-1/epubcheck-3.0-RC-1.jar charlie.epub
Epubcheck Version 3.0-RC-1

Validating against EPUB version 3.0
No errors or warnings detected.
</code></pre></div>


<p>やたー！おめでとう！</p>

<p>すべてのエラーと警告が解消しました。EPUBのミニマムを満たした電子書籍の完成です。</p>

<h2>EPUB Readerで見る</h2>

<p>完成した<code>charlie.epub</code>をEPUB Readerで見てみます。ここでは、<a href="https://itunes.apple.com/jp/app/kitabu/id492498910?mt=12" title="Mac App Store - Kitabu">Kitabu</a>を使います。</p>

<p>ファイルを開きます。</p>

<p><img src="/assets/images/2012/book01.png" alt="book" width=320 />
<img src="/assets/images/2012/book02.png" alt="book" width=320 /></p>




<p><img src="/assets/images/2012/book03.png" alt="book" width=320 />
<img src="/assets/images/2012/book04.png" alt="book" width=320 /></p>


<p>スバラシイ！</p>

<p>ただ、残念なことにKitabuはEPUB3に対応していないようで、目次が表示できません。EPUB2ではNCXというファイル形式で目次を記述するようです。</p>

<h2>iBooksで見る</h2>

<p>EPUB3に対応した<a href="https://itunes.apple.com/jp/app/ibooks/id364709193?mt=8" title="iTunes App Store で見つかる iPhone、iPod touch、iPad 対応 iBooks">iBooks</a>に送って見てみましょう。</p>

<p><img src="/assets/images/2012/book05.png" alt="book" width=320 />
<img src="/assets/images/2012/book06.png" alt="book" width=320 /></p>


<p>いいですね！</p>

<p>EPUB、最初の一歩、踏み出してみませんか？</p>

<hr />

<p>参考情報：</p>

<p><a href="http://www.kobu.com/docs/epub/" title="日本語Epubブックサンプル - 横浜工文社">日本語Epubブックサンプル - 横浜工文社</a></p>

<p><a href="http://tutorial.epubcafe.jp/" title="EPUB3チュートリアル">EPUB3チュートリアル</a></p>

<p><a href="http://www.slideshare.net/lost_and_found/iipabu-11542571" title="いいパブッ!! - よくわかるEPUB 3">いいパブッ!! - よくわかるEPUB 3</a></p>

<p><a href="http://naoki.sato.name/lab/archives/45" title="電子書籍ファイルePubについて -ePubを自分で作成する- « lab.naoki.sato.name">電子書籍ファイルePubについて -ePubを自分で作成する- « lab.naoki.sato.name</a></p>

<p><a href="http://naoki.sato.name/ocf/ocf_1_0_spec_ja.html" title="OEBPS Container Format (OCF) 1.0 日本語版">OEBPS Container Format (OCF) 1.0 日本語版</a></p>

<p><a href="http://idpf.org/epub/30/spec/epub30-overview.html" title="EPUB 3 Overview">EPUB 3 Overview</a></p>

<p><a href="http://lamium.blogspot.jp/2011/05/epub-zip.html" title="Sus scrofa liaodongensis: EPUB ZIP コンテナの作り方">Sus scrofa liaodongensis: EPUB ZIP コンテナの作り方</a></p>

<hr />

<p><a href="http://www.amazon.co.jp/EPUB-標準マニュアル-FUSEe-Sigil-テキストで作る/dp/4844332112?SubscriptionId=06WK2XPKDH9TJJ979P02&tag=keyesblog05-22&linkCode=xm2&camp=2025&creative=165953&creativeASIN=4844332112"><img class="amazon" src="http://ecx.images-amazon.com/images/I/51jHYFufT6L._SL160_.jpg" /></a>
<a href="http://www.amazon.co.jp/EPUB-標準マニュアル-FUSEe-Sigil-テキストで作る/dp/4844332112?SubscriptionId=06WK2XPKDH9TJJ979P02&tag=keyesblog05-22&linkCode=xm2&camp=2025&creative=165953&creativeASIN=4844332112">EPUB 3 標準マニュアル FUSEe β/Sigil/Word/テキストで作る!</a> by イースト株式会社 押山 隆</p>

<hr />

<div class="footnotes">
    <ol>
        <li id='fn:1'>http://lamium.blogspot.jp/2011/05/epub-zip.html <a href='#fnref:1' rev='footnote'>↩</a></li>
    </ol>
</div>





    <div class="ad" id="topAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* foot */
      google_ad_slot = "7511276945";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <hr>
    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2012/11/12/epub-tutorial/" class="hatena-bookmark-button" data-hatena-bookmark-title="エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2012/11/12/epub-tutorial/" data-text="エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2012/11/12/epub-tutorial/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2012/11/12/epub-tutorial/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2012/11/07/play-gviz-with-colorable" title="Rubyライブラリ「Colorable」とGvizを使ってGraphvizで綺麗なリングを描く">&larr; Previous</a></li>
      
        <li><a href="/">Archive</a></li>
        <!--<li><a href="/archive.html">Archive</a></li>-->
      
        <li class="next"><a href="/2012/12/03/when-bloggers-become-publishers" title="RubyによるMarkdownをベースにしたEPUB電子書籍の作り方と出版のお知らせ">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'melborne'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span3">
    <div id="bookAd">
      <a href="/books/">
        <!--<img src="/assets/images/2012/start_ruby.jpg" alt="start_ruby" />-->
        <!--<img src="/assets/images/2012/jekyll_cover.jpg" alt="jekyll" />-->
        <!--<img src="/assets/images/2012/ruby_parallel_cover.png" alt="ruby_parallel" />-->
        <!--<img src="/assets/images/2012/js_oop_cover.png" alt="js_oop" />-->
        <!--<img src="/assets/images/2012/rack_cover.png" alt="rack" />-->
        <!--<img src="/assets/images/2013/02/ruby_object_cover.png" alt="ruby_object" />-->
        <img src="/assets/images/2013/03/ruby_trivia_cover.png" alt="ruby_trivia" />
      </a>
      <p id="comment">100円で好評発売中！<br/><a href="/books/">M'ELBORNE BOOKS</a></p>
    </div>

    <hr />
    
      <ul class="tag_box inline">
      
      


  
     
    	<li><a href="/tags.html#epub-ref">epub <span>7</span></a></li>
    
  



      </ul>
      <hr />
    

    <ul class="social_button inline">
      <li id="hatena">
  <a href="http://b.hatena.ne.jp/entry/http://melborne.github.io/2012/11/12/epub-tutorial/" class="hatena-bookmark-button" data-hatena-bookmark-title="エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩" data-hatena-bookmark-layout="horizontal" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="30" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</li>

<li id="twitter">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://melborne.github.io/2012/11/12/epub-tutorial/" data-text="エラーメッセージから学ぶ電子書籍EPUB - 最初の一歩" data-via="merborne" data-lang="ja" data-size="" data-count="horizontal"></a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</li>

<li id="google">
  <link rel="canonical" href="http://melborne.github.io/2012/11/12/epub-tutorial/" />
  <g:plusone size="medium"></g:plusone>
  
  <script type="text/javascript">
    window.___gcfg = {lang: 'ja'};
  
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>
</li>

<li id="facebook">
  <div class="fb-like" data-href="http://melborne.github.io/2012/11/12/epub-tutorial/" data-layout="button_count" data-send="false" data-width="150" data-show-faces="false"></div>
</li>

<li></li>




    </ul>

    <div class="ad" id="sideAdsense">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8790567277062819";
      /* sidebar */
      google_ad_slot = "0672114662";
      google_ad_width = 160;
      google_ad_height = 600;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>
  </div>
</div>


      </div>

      <footer>
        <p><a rel="license" href="http://creativecommons.org/licenses/by-nc/2.1/jp/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/2.1/jp/88x31.png" /></a>  kyoendo 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>        </p>
      </footer>

    </div> <!-- /container -->

    

    <script type="text/javascript">
      if (location.hostname != 'localhost') {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-288751-18']);
        _gaq.push(['_trackPageview']);
  
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      };
    </script>

    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <script src="/assets/javascripts/jquery-1.7.2.min.js"></script>
    <script src="/assets/javascripts/lightbox.js"></script>

    <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>
  </body>
</html>

